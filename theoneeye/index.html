<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The One Eye AI - Professional Analysis</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2592/2592223.png">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2592/2592223.png">
    <link rel="preconnect" href="https://generativelanguage.googleapis.com">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        :root { --primary: #00ff88; --secondary: #ff4d4d; }
        body { font-family: 'Inter', sans-serif; background: #000; color: #fff; overflow-x: hidden; touch-action: manipulation; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .eye-socket { width: 100px; height: 60px; background: #111; border-radius: 50%; border: 2px solid #333; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .pupil { width: 35px; height: 35px; background: #fff; border-radius: 50%; position: absolute; transition: 0.3s; }
        .scanning .pupil { animation: scanMove 1.5s infinite alternate ease-in-out; background: var(--primary); box-shadow: 0 0 20px var(--primary); }
        @keyframes scanMove { from { transform: translateX(-30px); } to { transform: translateX(30px); } }
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .history-item { border-left: 4px solid var(--primary); background: rgba(255,255,255,0.02); margin-bottom: 8px; padding: 12px; border-radius: 8px; }
    </style>
</head>
<body class="min-h-screen">

    <div id="legal-modal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center p-6 bg-black/95">
        <div class="glass p-8 rounded-[2.5rem] max-w-md text-center border-orange-500/30 shadow-2xl">
            <div class="text-5xl mb-4">⚠️</div>
            <h2 class="text-2xl font-black text-orange-500 mb-4 uppercase italic">Terms of Use</h2>
            <div class="text-[11px] leading-relaxed text-zinc-400 space-y-4 mb-8 h-48 overflow-y-auto px-2 text-left border-b border-white/5 pb-4">
                <p>1. This AI tool is for <b>Educational & Entertainment</b> purposes only.</p>
                <p>2. Analysis results are based on data probability and do not replace professional advice.</p>
                <p>3. The developer holds no liability for decisions made based on this app.</p>
                <p>4. By proceeding, you agree to verify critical information independently.</p>
            </div>
            <div class="flex flex-col gap-3">
                <button onclick="acceptLegal()" class="w-full bg-orange-600 hover:bg-orange-500 p-5 rounded-2xl font-black transition-all uppercase tracking-tighter">Accept & Enter</button>
                <button onclick="closeApp()" class="w-full bg-zinc-900 p-3 rounded-xl font-bold text-zinc-600 text-xs uppercase">Exit</button>
            </div>
        </div>
    </div>

    <div id="app-content" class="hidden opacity-0 transition-opacity duration-700">
        <header class="p-4 flex justify-between items-center glass sticky top-0 z-50">
            <span class="font-black text-xl tracking-tighter text-green-500 italic">THE ONE EYE</span>
            <div id="google_translate_element" class="opacity-70 scale-90"></div>
        </header>

        <main class="max-w-md mx-auto px-6 py-8">
            <div id="ui-main" class="space-y-8 fade-in">
                <div class="text-center">
                    <h1 class="text-4xl font-black mb-2 tracking-tighter uppercase italic">Vision Engine</h1>
                    <p class="text-zinc-600 text-[9px] uppercase tracking-[0.4em]">Advanced Bio-Metric Simulation</p>
                </div>

                <div class="glass p-2 rounded-[2.5rem] border-white/10 shadow-inner">
                    <input id="user-input" type="text" class="w-full p-6 bg-transparent text-center text-xl outline-none placeholder-zinc-800 font-bold" placeholder="Ask anything...">
                </div>

                <div class="grid grid-cols-1 gap-4">
                    <button onclick="process('text')" class="w-full bg-blue-600 hover:bg-blue-500 p-6 rounded-[2rem] font-black text-2xl shadow-xl active:scale-95 transition-all">ANALYZE ⚡</button>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="triggerInput('file')" class="bg-zinc-900 border border-white/5 p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-zinc-400">Upload File</button>
                        <button onclick="triggerInput('camera')" class="bg-zinc-900 border border-white/5 p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-zinc-400">Live Camera</button>
                    </div>
                </div>

                <div class="mt-10">
                    <h3 class="text-xs font-black text-zinc-500 uppercase tracking-widest mb-4">Recent Scans</h3>
                    <div id="history-container" class="max-h-40 overflow-y-auto pr-2 space-y-2">
                        </div>
                </div>
                
                <button onclick="closeApp()" class="w-full p-3 text-zinc-800 text-[9px] font-bold uppercase tracking-widest">Terminate Session</button>
            </div>

            <div id="ui-loader" class="hidden py-20 text-center fade-in">
                <div class="flex justify-center mb-6"><div class="eye-socket scanning"><div class="pupil"></div></div></div>
                <p class="text-green-500 font-black tracking-widest text-xs uppercase animate-pulse">Computing Variables...</p>
            </div>

            <div id="ui-result" class="hidden space-y-6 fade-in">
                <div id="res-card" class="p-10 rounded-[4rem] border-[10px] bg-black text-center shadow-2xl transition-all duration-700">
                    <h2 id="res-decision" class="text-8xl font-black mb-4 tracking-tighter italic"></h2>
                    <div class="flex justify-between text-[10px] font-black mb-4 px-2 tracking-widest">
                        <span class="text-red-600" id="neg-val">NEG: 0%</span>
                        <span class="text-green-500" id="pos-val">POS: 0%</span>
                    </div>
                    <div class="w-full bg-zinc-900 rounded-full h-3 overflow-hidden flex border border-white/5">
                        <div id="bar-neg" class="bg-red-600 h-full transition-all duration-1000" style="width: 0%"></div>
                        <div id="bar-pos" class="bg-green-500 h-full transition-all duration-1000" style="width: 0%"></div>
                    </div>
                    <p id="res-summary" class="mt-8 text-sm leading-relaxed text-zinc-400 font-medium"></p>
                </div>
                <button onclick="location.reload()" class="w-full p-6 glass rounded-[2rem] font-black text-zinc-200 uppercase tracking-widest border-white/20">New Scan</button>
            </div>
        </main>
    </div>

    <input type="file" id="input-file" class="hidden" accept="image/*" onchange="process('image', 'file')">
    <input type="file" id="input-camera" class="hidden" accept="image/*" capture="environment" onchange="process('image', 'camera')">

    <script type="text/javascript">
        function googleTranslateElementInit() { new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element'); }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script>
        window.onload = () => {
            loadHistory();
            if (localStorage.getItem('oneEyeLegal') === 'agreed') showApp();
            else document.getElementById('legal-modal').classList.remove('hidden');
        };

        function acceptLegal() {
            localStorage.setItem('oneEyeLegal', 'agreed');
            document.getElementById('legal-modal').classList.add('hidden');
            showApp();
        }

        function showApp() {
            const app = document.getElementById('app-content');
            app.classList.remove('hidden');
            setTimeout(() => app.style.opacity = '1', 50);
        }

        function closeApp() {
            if(confirm("Exit Application?")) window.location.href = "about:blank";
        }

        function triggerInput(type) { document.getElementById(type === 'file' ? 'input-file' : 'input-camera').click(); }

        async function process(mode, source) {
            const val = document.getElementById('user-input').value;
            document.getElementById('ui-main').classList.add('hidden');
            document.getElementById('ui-loader').classList.remove('hidden');
            
            try {
                let img = null;
                if(mode === 'image') {
                    const input = document.getElementById(source === 'file' ? 'input-file' : 'input-camera');
                    if(input.files[0]) {
                        img = await new Promise(v => {
                            const rd = new FileReader();
                            rd.onload = () => v(rd.result.split(',')[1]);
                            rd.readAsDataURL(input.files[0]);
                        });
                    }
                }

                const res = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: `Analyze clearly. JSON ONLY: {"decision":"YES/NO","pos_score":0,"neg_score":0,"summary":"...","advice":"..."}. Context: ${val || 'Visual'}`,
                        imageData: img
                    })
                });
                
                const ai = await res.json();
                saveToHistory(val || 'Image Scan', ai.decision);
                
                setTimeout(() => {
                    document.getElementById('ui-loader').classList.add('hidden');
                    document.getElementById('ui-result').classList.remove('hidden');
                    const isY = ai.decision === 'YES';
                    const dec = document.getElementById('res-decision');
                    dec.innerText = ai.decision;
                    dec.style.color = isY ? '#00ff88' : '#ff4d4d';
                    document.getElementById('res-card').style.borderColor = isY ? '#00ff88' : '#ff4d4d';
                    document.getElementById('pos-val').innerText = `POS: ${ai.pos_score}%`;
                    document.getElementById('neg-val').innerText = `NEG: ${ai.neg_score}%`;
                    document.getElementById('bar-pos').style.width = `${ai.pos_score}%`;
                    document.getElementById('bar-neg').style.width = `${ai.neg_score}%`;
                    document.getElementById('res-summary').innerText = ai.summary;
                }, 1500);
            } catch(e) { alert("AI Core Offline. Reconnecting..."); location.reload(); }
        }

        function saveToHistory(topic, result) {
            let history = JSON.parse(localStorage.getItem('eye_history') || '[]');
            history.unshift({ topic, result, date: new Date().toLocaleTimeString() });
            localStorage.setItem('eye_history', JSON.stringify(history.slice(0, 10)));
        }

        function loadHistory() {
            const container = document.getElementById('history-container');
            const history = JSON.parse(localStorage.getItem('eye_history') || '[]');
            if(history.length === 0) {
                container.innerHTML = '<p class="text-[9px] text-zinc-700">No records found.</p>';
                return;
            }
            container.innerHTML = history.map(item => `
                <div class="history-item flex justify-between items-center">
                    <span class="text-[10px] font-bold text-zinc-300 truncate w-32">${item.topic}</span>
                    <span class="text-[9px] font-black ${item.result === 'YES' ? 'text-green-500' : 'text-red-500'}">${item.result}</span>
                </div>
            `).join('');
        }
    </script>
</body>
</html>